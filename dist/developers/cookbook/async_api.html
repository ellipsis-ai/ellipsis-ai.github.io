<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Ellipsis · Get work done in chat by ellipsis-ai</title>

    <link rel="stylesheet" href="/assets/css/style.css?v=ed781f0c570287fccb2d3eaaf8a5c246c1a9715d">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Ellipsis · Get work done in chat</h1>
        <p>Ellipsis documentation.
</p>

        
          <p class="view"><a href="http://github.com/ellipsis-ai/ellipsis-ai.github.io">View the Project on GitHub <small></small></a></p>
        

        

        
      </header>
      <section>

      <h1 id="async-api">Async API</h1>

<h2 id="problem">Problem</h2>
<p>You want to create a skill that uses an asynchronous API. You want the async API
to invoke an <a href="/developers/reference/actions/">action</a>, or notify a user or channel
when a specific event occurs.</p>

<h2 id="solution">Solution</h2>
<p>There are several ways to solve this use case depending on the details of the async
API and what control you have over it.</p>

<h3 id="case-1-you-have-full-control-over-the-async-api-and-system">Case 1: you have full control over the async API and system.</h3>
<p>In this case, you generate an auth token in your action code and pass it
to the async API with the request. You then change the code of the async API to call
the Ellipsis API using the auth token.</p>

<p><strong>Here’s an example:</strong></p>

<p>Report Generator is a system that builds complex Excel reports and stores them
in Amazon Web Services (AWS) S3. Some reports take a few minutes to generate, so
Report Generator has an async API. The goal is to implement an Ellipsis action
called <code class="highlighter-rouge">get_report</code> that uses the Report Generator API to request a new
report on behalf of the user, and then notify the user when the report is ready.</p>

<p>In Ellipsis, the <code class="highlighter-rouge">get_report</code> implementation looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>// request report action

const EllipsisApi = ellipsis.require('ellipsis-api');
const api = new EllipsisApi(ellipsis);

// Async API
const reportBuilder = require('my-report-builder');

// The token expires after 2 minutes.
api.generateToken({ isOneTime: false, expirySeconds: 120 })
  .then(token =&gt; {
    reportBuilder({
      reportType: "ARM",
      startDate: "2017-01-01",
      endDate: "2017-02-01",
      ellipsisData: {
        user: "@mark",
        authToken: token.id
      }
    });
    //...
});
</code></pre>
</div>

<p>Assuming the Request Report system is implemented in Node.js, somewhere in the
code, after the report has been generated and uploaded to S3, you can use the Ellipsis
API to notify the user that the requested report is ready:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>const request = require('request');
const ellipsisData = getEllipsisData();

const content = {
  message: "Your report is ready: https://reports-123.s3.aws.amazon.com/report-123asdasf3425.xls",
  responseContext: "slack",
  channel: ellipsisData.user,
  token: ellipsisData.token
};
request({
  url: "https://bot.ellipsis.ai/api/v1/say",
  method: "POST",
  json: true,
  body: content
}, (error, response, body) =&gt; {
  console.log(response);
});
</code></pre>
</div>

<h2 id="see-also">See also</h2>
<ul>
  <li><a href="/developers/reference/api/v1/overview.html">Ellipsis API</a></li>
</ul>


      </section>
      <footer>
        
        <p>This project is maintained by <a href="http://github.com/ellipsis-ai">ellipsis-ai</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>


  
  </body>
</html>
